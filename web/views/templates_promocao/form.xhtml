<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"  
      xmlns:h="http://xmlns.jcp.org/jsf/html"  
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:a="http://xmlns.jcp.org/jsf/passthrough"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    <ui:include src="views/helpers/header.xhtml">
        <ui:param name="title" value="A mudar"/>
    </ui:include>
    <h:body>
        <div class="ui text container">
            <center>
                <h1>
                    Colocar título baseado na operação
                </h1>
            </center>
            <h:form class="ui form" id="form">
                <h:inputHidden value="#{promocaoBean.promocao.id_promocao}" id="id_promocao" a:name="id_promocao"/>
                <div class="field">
                    <h:outputLabel for="nome_peca">#{msg['promocao.list.peca_nome']}</h:outputLabel>  
                    <h:inputText value="#{promocaoBean.promocao.nome_peca}" id="nome_peca" a:name="nome_peca" a:type="text">
                        <f:validateRequired/>
                    </h:inputText>
                </div>
                <div class="field">
                    <h:outputLabel for="preco">#{msg['promocao.list.preco']}</h:outputLabel>  
                    <h:inputText value="#{promocaoBean.promocao.preco}" id="preco" a:name="preco" a:type="text">
                        <f:validateRequired/>
                    </h:inputText>
                </div>
                <div class="field">
                    <h:outputLabel for="datetime">#{msg['promocao.list.data_hora']}</h:outputLabel>   
                    <h:inputText value="#{promocaoBean.promocao.datetime}" id="datetime" a:name="datetime" a:type="text" a:placeholder="DD/MM/YY HH:MM:SS">
                        <f:validateRequired/>
                    </h:inputText>
                </div>
                <div class="field">
                    <h:outputLabel for="endereco_url">#{msg['promocao.list.endereco']}</h:outputLabel>   
                    <div class="col-sm-4">
                        <h:selectOneMenu id="endereco_url" value="#{promocaoBean.promocao.siteDeVenda.id}">
                            <f:selectItems value="#{promocaoBean.sitesDeVenda}"/>
                            <f:converter converterId="SiteDeVendaConverter" />
                        </h:selectOneMenu>
                    </div>      
                </div>
                <div class="field">
                    <h:outputLabel for="cnpj_teatro">#{msg['promocao.list.sala_teatro']}</h:outputLabel>   
                    <div class="col-sm-4">
                        <h:selectOneMenu id="cnpj_teatro" value="#{promocaoBean.promocao.teatro.id}">
                            <f:selectItems value="#{promocaoBean.teatros}"/>
                            <f:converter converterId="SalaDeTeatroConverter" />
                        </h:selectOneMenu>
                    </div>
                    <div class="ui negative message hidden">
                        <p>#{msg['allform.error']}</p>
                    </div>
                    <h:commandButton value="Submit" action="#{promocaoBean.salva()}" class="ui positive button"/>
                </div>
            </h:form>
        </div>
        <script>
            $(document).ready(function () {
                form = $('.ui.form');
                id_promocao = $('#id_promocao');
                nome_peca = $('#nome_peca');
                preco = $('#preco');
                datetime = $('#datetime');
                endereco_url = $('#endereco_url');
                cnpj_teatro = $('#cnpj_teatro');
                action = #{teatro eq null? 'cadastro' : 'edicao'};
                form.form({
                    fields: {
                        nome_peca: {
                            identifier: 'nome_peca',
                            rules: [
                                {
                                    type: 'empty',
                                    prompt: '#{msg['allform.required']}'
                                }
                            ]
                        },
                        preco: {
                            identifier: 'preco',
                            rules: [
                                {
                                    type: 'empty',
                                    prompt: '#{msg['allform.required']}'
                                }
                            ]
                        },
                        datetime: {
                            identifier: 'datetime',
                            rules: [
                                {
                                    type: 'empty',
                                    prompt: '#{msg['allform.required']}'
                                }
                            ]
                        },
                        endereco_url: {
                            identifier: 'endereco_url',
                            rules: [
                                {
                                    type: 'empty',
                                    prompt: '#{msg['allform.required']}'
                                }
                            ]
                        },
                        cnpj_teatro: {
                            identifier: 'cnpj_teatro',
                            rules: [
                                {
                                    type: 'empty',
                                    prompt: '#{msg['allform.required']}'
                                }
                            ]
                        }
                    },
                    on: 'blur',
                    inline: true,
                    onSuccess: function () {
                        form.removeClass('success').removeClass('error');
                    },
                    onFailure: function () {
                        window.scrollTo(0, 0);
                        form.removeClass('success').removeClass('error');
                    }
                }).on('submit', function (e) {
                    e.preventDefault();
                    if (!form.form('is valid'))
                        return;
                    form.addClass('loading');
                    $.post(action, {
                        id_promocao: id_promocao.val(),
                        nome_peca: nome_peca.val(),
                        preco: preco.val(),
                        datetime: datetime.val(),
                        endereco_url: endereco_url.val(),
                        cnpj_teatro: cnpj_teatro.val()
                    }).done(function () {
                        window.location.href = 'gerenciar';
                    }).fail(function () {
                        form.removeClass('loading');
                        $('.ui.message').show();
                    });
                });
            }
            );
        </script>
        <ui:include src="views/helpers/footer.xhtml"/>
    </h:body>
</html>

